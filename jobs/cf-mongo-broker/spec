---
name: cf-mongo-broker

templates:
  cf-mongo-broker_ctl.erb: bin/cf-mongo-broker_ctl
  process-watcher_ctl.erb: bin/process-watcher_ctl
  nginx_ctl.erb: bin/nginx_ctl
  route-registrar_ctl: bin/route-registrar_ctl

  broker.yml.erb: config/broker.yml
  nginx.conf.erb: config/nginx.conf
  mongo.conf.erb: config/mongo.conf
  registrar_settings.yml.erb: config/registrar_settings.yml

  drain.sh: bin/drain

packages:
- cf-mongo-broker
- nginx
- mongo
- route-registrar
- python

properties:
  mongo.statefile_path:
    default: /var/vcap/store/cf-mongo-broker/statefile.json
    description: Path to the broker statefile
  mongo.data_directory:
    default: /var/vcap/store/cf-mongo-broker/mongo-data
    description: The directory which stores the persisted broker data
  mongo.log_directory:
    default: /var/vcap/sys/log/mongo
    description: The directory which stores the mongo server logs
  mongo.conf_path:
    default: /var/vcap/jobs/cf-mongo-broker/config/mongo.conf
    description: The shared conf file for all Mongo instances
  mongo.maxmemory:
    default: 524288000
    description: The maximum memory (in bytes) that Mongo will use before evicting old data
  mongo.config_command:
    description: The name of the obfuscated mongo CONFIG command.
  mongo.save_command:
    default: ""
    description: The name of the obfuscated mongo SAVE command.
  mongo.bg_save_command:
    default: ""
    description: The name of the obfuscated mongo BGSAVE command.
  mongo.client_timeout:
    default: 0
    description: Close the connection after a client is idle for N seconds (0 to disable)
  mongo.tcp_keep_alive:
    default: 0
    description: TCP keepalive
  mongo.log_level:
    default: notice
    description: Specify the server log verbosity level (debug, verbose, notice, warning)
  mongo.databases:
    default: 16
    description: Set the number of databases. The default database is DB 0.
  mongo.broker.service_name:
    description: Service name displayed in the catalog metadata
    default: p-mongo
  mongo.broker.service_id:
    description: Service id displayed in the catalog metadata
    default: EEA47C3A-569C-4C24-869D-0ADB5B337A4C
  mongo.broker.shared_vm_plan_id:
    description: Shared-VM plan id displayed in the catalog metadata
    default: C210CA06-E7E5-4F5D-A5AA-7A2C51CC290E
  mongo.broker.dedicated_vm_plan_id:
    description: Dedicated-VM plan id displayed in the catalog metadata
    default: 74E8984C-5F8C-11E4-86BE-07807B3B2589
  mongo.broker.process_check_interval:
    description: Interval in seconds between checks for dead processes
    default: 10
  mongo.broker.start_mongo_timeout:
    description: Maximum wait time in seconds for Mongo to start up
    default: 600
  mongo.broker.service_instance_limit:
    description: The maximum number of instances allowed
    default: 1
  mongo.broker.auth.username:
    default: admin
    description: The username for HTTP Basic Auth on the Broker, also used for the agent
  mongo.broker.auth.password:
    default: admin
    description: The password for HTTP Basic Auth on the Broker, also used for the agent
  mongo.broker.backend_port:
    default: 10005
    description: The port for the broker unicorn process to run on
  mongo.broker.backend_host:
    default: localhost
    description: The port for the broker unicorn process to run on
  mongo.broker.subdomain:
    default: mongo-broker
    description: Subdomain for route registrar

  mongo.broker.dedicated_nodes:
    description: List of node IPs for the dedicated plan
    default: []
  mongo.broker.dedicated_port:
    description: The port used by the mongo instances
    default: 6379

  mongo.broker.name:
    default: mongo
    description: Name of the broker, to be used in cf commandline operations and by the broker-registrar

  mongo.broker.network:
    description: The name of the network that the mongo broker runs on.

  mongo.MONGODB_BINDIP:
    description: IP address that MongoDB binds to in order to listen for connections
    default: 0.0.0.0
  mongo.MONGODB_PORT:
    description: TCP port on which the MongoDB instance listens for client connections
    default: 27017
  mongo.MONGODB_STORAGE_DBPATH:
    description: The directory where the mongo instance stores its data.
    default: /var/vcap/store/mongo
  mongo.MONGODB_SYSTEMLOG:
    description: Sends all diagnostic logging information to a log file instead of to standard output or to the hostâ€™s syslog system
    default: /var/vcap/sys/log/mongo/mongo.log
  mongo.MONGODB_REPLSET_NAME:
    description:  Specify a replica set name as an argument to this set.
  mongo.MONGODB_REPLSET_KEY:
    description: Specify key which will be used in keyfile
  mongo.MONGODB_REPLSET_SECURED:
    description: Specify if Replica Set will be secured
    default: false
  mongo.MONGODB_USER:
    description: 'MongoDB username'
  mongo.MONGODB_PASS:
    description: 'MongoDB password'
  mongo.MONGODB_DATABASE:
    description: 'MongoDB database'
  mongo.MONGODB_HOST:
    description: 'MongoDB hostname'
  mongo.MONGODB_URI:
    description: 'MongoDB URI'

  cf.apps_domain:
    description: Domain shared by the UAA and CF API eg 'bosh-lite.com'
  cf.nats.host:
    description: Hostname/IP of NATS
  cf.nats.port:
    description: Port that NATS listens on
  cf.nats.username:
    description: The user to use when authenticating with NATS
  cf.nats.password:
    description: The password to use when authenticating with NATS
